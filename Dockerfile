# Base image - use the official Python 3.12 image as the base
FROM python:3.12-slim

ARG db_name
ENV DATABASE_NAME=${db_name}

ARG db_user
ENV DATABASE_USER=${db_user}

ARG db_password
ENV DATABASE_PASSWORD=${db_password}

ARG db_host
ENV DATABASE_HOST=${db_host}

ARG db_port
ENV DATABASE_PORT=${db_port}

ARG huggingface_token
ENV HUGGINGFACE_TOKEN=${huggingface_token}


# Install system utilities
RUN apt-get update && apt-get install -y \
    iproute2 \
    procps \
    && rm -rf /var/lib/apt/lists/*

# Set the working directory inside the container
WORKDIR /app

# Copy the requirements file to the working directory
COPY requirements.txt .

# Install any dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Copy the rest of the application code to the container
COPY src/ ./src/
COPY data/ ./data/

# Make sure the data directory exists
RUN mkdir -p data

# Set the environment variable to ensure consistent Python output (no buffering)
ENV PYTHONUNBUFFERED=1

# Command to run the main script when the container starts
# CMD ["python3", "src/main.py"]
CMD ["sh", "-c", "python3 src/main.py; sleep 1200"]
